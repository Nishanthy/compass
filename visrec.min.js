!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.vr=e()}}(function(){return function e(n,r,t){function i(o,u){if(!r[o]){if(!n[o]){var f="function"==typeof require&&require;if(!u&&f)return f(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};n[o][0].call(l.exports,function(e){var r=n[o][1][e];return i(r?r:e)},l,l.exports,e,n,r,t)}return r[o].exports}for(var a="function"==typeof require&&require,o=0;o<t.length;o++)i(t[o]);return i}({1:[function(e,n){var r=n.exports={};r.gen=e("./visgen"),r.rank=e("./visrank")},{"./visgen":2,"./visrank":3}],2:[function(e,n){(function(e){function r(e){var n={},r=e.enc;return v.keys(r).forEach(function(e){var t=v.duplicate(r[e]);t.type=e,n[t.name||""]=t,delete t.name}),{marktype:e.marktype,col:n}}function t(e,n){return void 0!==e.value?n.push(e.value):(e.left&&t(e.left,n),e.right&&t(e.right,n)),n}function i(e){return e.bin||"O"===e.type}function a(e){return e.x&&e.y&&i(e.x)&&i(e.y)}function o(e,n){if(e.x||e.y||e.geo||e.text||e.arc){if(e.x&&e.y&&n.omitTranpose&&e.x.type==e.y.type&&e.x.name>e.y.name)return!1;if(e.row||e.col){if(!e.x||!e.y)return!1;if(n.omitAggrWithAllDimsOnFacets){var r=!1,t=!1;for(var a in e){var o=e[a];if(o.aggr&&(r=!0),i(o)&&"row"!==a&&"col"!==a&&(t=!0),r&&t)break}if(r&&!t)return!1}}return e.x&&"count"==e.x.aggr&&!e.y?!1:e.y&&"count"==e.y.aggr&&!e.x?!1:!0}return!1}function u(e,n){if(e.x&&e.y){if(n.omitTranpose&&a(e))return!1;if(i(e.x)&&i(e.y)){if(e.shape)return!1;if(e.color&&i(e.color))return!1}}else{if(n.omitTranpose&&e.y)return!1;if(n.omitDotPlotWithExtraEncoding&&v.keys(e).length>1)return!1;if(e.shape)return!1}return!0}function f(e,n){return void 0!==e.x.aggr^void 0!==e.y.aggr?n.omitTranpose&&a(e)?!1:!0:!1}function c(e){return"T"==e.x&&"Q"==e.y}function l(e,n,r,t){return e.map(0===r?n:function(e){var i=l(e,n,r-1);return t?i.filter(A):i})}function s(e,n,r,t){return 0===r?e.reduce(n,[]):e.map(function(e){var i=s(e,n,r-1);return t?i.filter(A):i})}function g(e){return(e?v.keys(e):[]).reduce(function(n,r){return n[r]=e[r],n},Object.create(h.DEFAULT_OPT))}function p(e,n){var r={};return e.forEach(function(e){r[e]=!0}),n.forEach(function(e){r[e]=!0}),v.keys(r)}function d(e,n,r){if(arguments.length<3&&(r=1,arguments.length<2&&(n=e,e=0)),(n-e)/r===1/0)throw new Error("infinite range");var t,i=[],a=y(_(r)),o=-1;if(e*=a,n*=a,r*=a,0>r)for(;(t=e+r*++o)>n;)i.push(t/a);else for(;(t=e+r*++o)<n;)i.push(t/a);return i}function y(e){for(var n=1;e*n%1;)n*=10;return n}var v="undefined"!=typeof window?window.vl:"undefined"!=typeof e?e.vl:null,m="undefined"!=typeof window?window.clusterfck:"undefined"!=typeof e?e.clusterfck:null,h=n.exports={};h.DEFAULT_OPT={genAggr:!0,genBin:!0,genTypeCasting:!1,aggrList:[void 0,"avg"],marktypeList:["point","bar","line","area","text"],omitTranpose:!0,omitDotPlotWithExtraEncoding:!0,omitAggrWithAllDimsOnFacets:!0,omitDimensionOnly:!0,omitAggregateWithMeasureOnly:!0};var T=v.encodingTypes,w=15,x=[["x","y",.2],["row","col",.2],["color","shape",.2],["color","alpha",.2],["size","alpha",.2],["size","color",.2]].reduce(function(e,n){var r=n[0],t=n[1],i=n[2];return e[r]=e[r]||{},e[t]=e[t]||{},e[r][t]=e[t][r]=i,e},{}),k=100,O=1;h._getDistance=function(e,n){var r=p(v.keys(e.col),v.keys(n.col)),t=0;return r.forEach(function(r){var i=e.col[r],a=n.col[r];i&&a?i.type!=a.type&&(t+=(x[i.type]||{})[a.type]||1):t+=k}),t},h.getDistanceTable=function(e){var n,t=e.length,i=e.map(function(e){return r(e)}),a=new Array(t);for(n=0;t>n;n++)a[n]=new Array(t);for(n=0;t>n;n++)for(j=n+1;j<t;j++)a[j][n]=a[n][j]=h._getDistance(i[n],i[j]);return a},h.cluster=function(e){var n=h.getDistanceTable(e),r=e.length,i=m.hcluster(d(r),function(e,r){return n[e][r]},"average",O),a=i.map(function(e){return t(e,[])});return a};var E=h.marksRule=o;E.point=u,E.bar=f,E.line=c,E.area=c;var b={x:{dataTypes:v.dataTypes.O+v.dataTypes.Q+v.dataTypes.T,multiple:!0},y:{dataTypes:v.dataTypes.O+v.dataTypes.Q+v.dataTypes.T,multiple:!0},row:{dataTypes:v.dataTypes.O,multiple:!0},col:{dataTypes:v.dataTypes.O,multiple:!0},shape:{dataTypes:v.dataTypes.O},size:{dataTypes:v.dataTypes.Q},color:{dataTypes:v.dataTypes.O+v.dataTypes.Q},alpha:{dataTypes:v.dataTypes.Q},text:{dataTypes:w}},A=function(e){return!D(e)||e.length>0};h.generateCharts=function(e,n,r,t){n=g(n),t=void 0===t?{encodings:1}:t;var i,a,o=n.genAggr?h.genAggregate([],e,n):[e],u=0;return t===!0||t&&t.aggr?i=o.reduce(function(e,r){return h.genFieldEncodings(e,r,n)},[]):(i=o.map(function(e){return h.genFieldEncodings([],e,n)},!0),u+=1),t===!0||t&&t.encodings?a=s(i,function(e,t){return h.genMarkTypes(e,t,n,r)},u,!0):(a=l(i,function(e){return h.genMarkTypes([],e,n,r)},u,!0),u+=1),a},h.genMarkTypes=function(e,n,r,t){return r=g(r),h._getSupportedMarkTypes(n,r).forEach(function(r){e.push({marktype:r,enc:n,cfg:t})}),e},h._getSupportedMarkTypes=function(e,n){var r=n.marktypeList.filter(function(r){var t=v.marks[r],i=t.requiredEncoding,a=t.supportedEncoding;for(var o in i)if(!(i[o]in e))return!1;for(var u in e)if(!a[u])return!1;return!E[r]||E[r](e,n)});return r},h.genAggregate=function(e,n,r){function t(o,u){if(o===n.length){if(r.omitAggregateWithMeasureOnly||r.omitDimensionOnly){var f=!1,c=!1,l=!1;if(a.forEach(function(e){i(e)?c=!0:(f=!0,e.aggr||(l=!0))}),!f&&r.omitDimensionOnly)return;if(!c&&!l&&r.omitAggregateWithMeasureOnly)return}return void e.push(v.duplicate(a))}var s=n[o];switch(s.type){case"Q":if(a[o]={name:s.name,type:s.type},s.aggr)a[o].aggr=s.aggr,t(o+1,!0);else if(s._aggr){var g="*"==s._aggr?r.aggrList:s._aggr;for(var p in g){var d=g[p];void 0!==d?(u===!0||null===u)&&(a[o].aggr=d,t(o+1,!0)):(u===!1||null===u)&&(delete a[o].aggr,t(o+1,!1))}r.genBin&&(delete a[o].aggr,a[o].bin=!0,a[o].type="Q",t(o+1,u)),r.genTypeCasting&&(delete a[o].aggr,delete a[o].bin,a[o].type="O",t(o+1,u))}else t(o+1,!1);break;case"O":default:a[o]=s,t(o+1,u)}}var a=new Array(n.length);return r=g(r),t(0,null),e},h.genFieldEncodings=function(e,n,r){function t(a){if(a===n.length)return void(E(i,r)&&e.push(v.duplicate(i)));var o=n[a];for(var u in T){var f=T[u];!(f in i)&&(b[f].dataTypes&v.dataTypes[o.type])>0&&(i[f]=o,t(a+1),delete i[f])}}var i={};return t(0),e};var D=Array.isArray||function(e){return"[object Array]"==toString.call(e)},_=Math.abs}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n){(function(e){var r="undefined"!=typeof window?window.vl:"undefined"!=typeof e?e.vl:null,t=n.exports={},i={Q:{x:1,y:1,size:.6,color:.4,alpha:.4},O:{x:.99,y:1,row:.7,col:.7,color:.8,shape:.6}},a=.01,o=.5,u={line:.99,area:.98,bar:.97,point:.96,circle:.95,square:.95,text:.8};t.encodingScore=function(e){var n={},t=r.keys(e.enc);return t.forEach(function(r){var t=e.enc[r];n[t.name]={value:t.type+":"+r,score:i[t.type][r]||a}}),t.length>1&&(e.enc.x&&e.enc.y||e.enc.geo||(n.unusedPosition={score:o})),n.markType={value:e.marktype,score:u[e.marktype]},{score:r.keys(n).reduce(function(e,r){return e*n[r].score},1),features:n}},t.fieldsScore=function(){}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});
//# sourceMappingURL=visrec.min.js.map